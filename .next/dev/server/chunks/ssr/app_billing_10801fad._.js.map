{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/app/billing/billing.module.css [app-ssr] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"active\": \"billing-module__Nlsdbq__active\",\n  \"avatar\": \"billing-module__Nlsdbq__avatar\",\n  \"container\": \"billing-module__Nlsdbq__container\",\n  \"content\": \"billing-module__Nlsdbq__content\",\n  \"currentPlan\": \"billing-module__Nlsdbq__currentPlan\",\n  \"currentPlanCard\": \"billing-module__Nlsdbq__currentPlanCard\",\n  \"faqItem\": \"billing-module__Nlsdbq__faqItem\",\n  \"faqSection\": \"billing-module__Nlsdbq__faqSection\",\n  \"featureItem\": \"billing-module__Nlsdbq__featureItem\",\n  \"featureList\": \"billing-module__Nlsdbq__featureList\",\n  \"label\": \"billing-module__Nlsdbq__label\",\n  \"loading\": \"billing-module__Nlsdbq__loading\",\n  \"nav\": \"billing-module__Nlsdbq__nav\",\n  \"navItem\": \"billing-module__Nlsdbq__navItem\",\n  \"period\": \"billing-module__Nlsdbq__period\",\n  \"planCard\": \"billing-module__Nlsdbq__planCard\",\n  \"planCardTitle\": \"billing-module__Nlsdbq__planCardTitle\",\n  \"planName\": \"billing-module__Nlsdbq__planName\",\n  \"plansGrid\": \"billing-module__Nlsdbq__plansGrid\",\n  \"price\": \"billing-module__Nlsdbq__price\",\n  \"priceSection\": \"billing-module__Nlsdbq__priceSection\",\n  \"sidebar\": \"billing-module__Nlsdbq__sidebar\",\n  \"title\": \"billing-module__Nlsdbq__title\",\n  \"upgradeBtn\": \"billing-module__Nlsdbq__upgradeBtn\",\n  \"userDetails\": \"billing-module__Nlsdbq__userDetails\",\n  \"userEmail\": \"billing-module__Nlsdbq__userEmail\",\n  \"userInfo\": \"billing-module__Nlsdbq__userInfo\",\n  \"userName\": \"billing-module__Nlsdbq__userName\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 37, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/abhig/Downloads/zip-explorer1/app/billing/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useSession } from \"next-auth/react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { useState, useEffect } from \"react\"\r\nimport Link from \"next/link\"\r\nimport { toast } from \"sonner\"\r\nimport styles from \"./billing.module.css\"\r\n\r\ndeclare global {\r\n  interface Window {\r\n    Razorpay: any\r\n  }\r\n}\r\n\r\ninterface Plan {\r\n  name: string\r\n  price: number\r\n  period: string\r\n  features: string[]\r\n  id: \"monthly\" | \"yearly\"\r\n}\r\n\r\nconst PLANS: Plan[] = [\r\n  {\r\n    name: \"Monthly\",\r\n    price: 2,\r\n    period: \"month\",\r\n    id: \"monthly\",\r\n    features: [\"Save up to 5 ZIP folders\", \"Extract unlimited files\", \"Unlimited downloads\", \"Share files with PIN\"],\r\n  },\r\n  {\r\n    name: \"Yearly\",\r\n    price: 499,\r\n    period: \"year\",\r\n    id: \"yearly\",\r\n    features: [\r\n      \"Save up to 15 ZIP folders\",\r\n      \"Extract unlimited files\",\r\n      \"Unlimited downloads\",\r\n      \"Share files with PIN\",\r\n      \"Best value - Save 15%\",\r\n    ],\r\n  },\r\n]\r\n\r\nexport default function BillingPage() {\r\n  const { data: session, status, update } = useSession()\r\n  const router = useRouter()\r\n\r\n  const [currentPlan, setCurrentPlan] = useState<string>(\"free\")\r\n  const [isLoading, setIsLoading] = useState(true)\r\n  const [isProcessing, setIsProcessing] = useState(false)\r\n\r\n  // Redirect if unauthenticated\r\n  useEffect(() => {\r\n    if (status === \"unauthenticated\") router.push(\"/login\")\r\n  }, [status, router])\r\n\r\n  // Fetch subscription plan from DB\r\n  useEffect(() => {\r\n    if (!session?.user) return\r\n\r\n    const fetchUserPlan = async () => {\r\n      try {\r\n        const response = await fetch(\"/api/user/stats\")\r\n        const data = await response.json()\r\n        if (data.success) {\r\n          setCurrentPlan(data.stats.subscriptionPlan || \"free\")\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Failed to fetch plan:\", error)\r\n      } finally {\r\n        setIsLoading(false)\r\n      }\r\n    }\r\n\r\n    fetchUserPlan()\r\n  }, [session])\r\n\r\n  // Razorpay script\r\n  useEffect(() => {\r\n    const script = document.createElement(\"script\")\r\n    script.src = \"https://checkout.razorpay.com/v1/checkout.js\"\r\n    script.async = true\r\n    document.body.appendChild(script)\r\n  }, [])\r\n\r\n  const renderPlanName = (plan: string) => {\r\n    return plan === \"monthly\" ? \"Monthly\" : plan === \"yearly\" ? \"Yearly\" : \"Free\"\r\n  }\r\n\r\n  const handleUpgrade = async (planId: \"monthly\" | \"yearly\") => {\r\n    if (!session?.user?.email) {\r\n      toast.error(\"Please sign in first\")\r\n      return\r\n    }\r\n\r\n    const razorpayKey = process.env.NEXT_PUBLIC_RAZORPAY_KEY_ID\r\n    if (!razorpayKey) {\r\n      console.error(\"âŒ Missing Razorpay key\")\r\n      toast.error(\"Payment system not configured\")\r\n      return\r\n    }\r\n\r\n    setIsProcessing(true)\r\n\r\n    try {\r\n      const orderResponse = await fetch(\"/api/payment/create-order\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ plan: planId }),\r\n      })\r\n\r\n      const orderData = await orderResponse.json()\r\n\r\n      if (!orderResponse.ok) {\r\n        toast.error(orderData.error || \"Failed to create order\")\r\n        return\r\n      }\r\n\r\n      console.log(\"Order Created:\", orderData.orderId)\r\n\r\n      const options = {\r\n        key: razorpayKey,\r\n        amount: orderData.amount,\r\n        currency: orderData.currency,\r\n        order_id: orderData.orderId,\r\n\r\n        handler: async (response: any) => {\r\n          try {\r\n            const verifyResponse = await fetch(\"/api/payment/verify\", {\r\n              method: \"POST\",\r\n              headers: { \"Content-Type\": \"application/json\" },\r\n              body: JSON.stringify({\r\n                orderId: orderData.orderId,\r\n                paymentId: response.razorpay_payment_id,\r\n                signature: response.razorpay_signature,\r\n              }),\r\n            })\r\n\r\n            const verifyData = await verifyResponse.json()\r\n\r\n            if (verifyResponse.ok) {\r\n              toast.success(`Subscription upgraded to ${planId}`)\r\n\r\n              // ðŸ”¥ Immediate UI update\r\n              setCurrentPlan(planId)\r\n\r\n              // ðŸ”¥ Refresh NextAuth session (CRITICAL FIX)\r\n              await update({ subscriptionPlan: planId })\r\n\r\n              setTimeout(() => router.push(\"/dashboard\"), 1500)\r\n            } else {\r\n              toast.error(verifyData.error || \"Verification failed\")\r\n            }\r\n          } catch (error) {\r\n            console.error(\"Verification error:\", error)\r\n            toast.error(\"Payment verification failed\")\r\n          }\r\n        },\r\n\r\n        prefill: {\r\n          name: session.user.name,\r\n          email: session.user.email,\r\n        },\r\n      }\r\n\r\n      if (window.Razorpay) {\r\n        new window.Razorpay(options).open()\r\n      } else {\r\n        toast.error(\"Razorpay failed to load\")\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Unexpected error:\", error)\r\n      toast.error(\"Upgrade failed\")\r\n    } finally {\r\n      setIsProcessing(false)\r\n    }\r\n  }\r\n\r\n  if (status === \"loading\" || isLoading) {\r\n    return <div className={styles.loading}>Loading...</div>\r\n  }\r\n\r\n  if (!session?.user) return null\r\n\r\n  return (\r\n    <div className={styles.container}>\r\n      {/* Sidebar */}\r\n      <div className={styles.sidebar}>\r\n        <div className={styles.userInfo}>\r\n          <div className={styles.avatar}>{session.user.name?.charAt(0).toUpperCase()}</div>\r\n          <div className={styles.userDetails}>\r\n            <h2 className={styles.userName}>{session.user.name}</h2>\r\n            <p className={styles.userEmail}>{session.user.email}</p>\r\n          </div>\r\n        </div>\r\n\r\n        <nav className={styles.nav}>\r\n          <Link href=\"/dashboard\" className={styles.navItem}>Dashboard</Link>\r\n          <Link href=\"/billing\" className={`${styles.navItem} ${styles.active}`}>Billing</Link>\r\n          <Link href=\"/\" className={styles.navItem}>Back to Explorer</Link>\r\n        </nav>\r\n      </div>\r\n\r\n      {/* Main */}\r\n      <main className={styles.content}>\r\n        <h1 className={styles.title}>Billing & Plans</h1>\r\n\r\n        <div className={styles.currentPlan}>\r\n          <p className={styles.label}>Current Plan</p>\r\n          <h2 className={styles.planName}>{renderPlanName(currentPlan)}</h2>\r\n        </div>\r\n\r\n        <div className={styles.plansGrid}>\r\n          {PLANS.map((plan) => (\r\n            <div\r\n              key={plan.id}\r\n              className={`${styles.planCard} ${currentPlan === plan.id ? styles.currentPlanCard : \"\"}`}\r\n            >\r\n              <h3 className={styles.planCardTitle}>{plan.name}</h3>\r\n\r\n              <div className={styles.priceSection}>\r\n                <span className={styles.price}>â‚¹{plan.price}</span>\r\n                <span className={styles.period}>/{plan.period}</span>\r\n              </div>\r\n\r\n              <ul className={styles.featureList}>\r\n                {plan.features.map((f, i) => (\r\n                  <li key={i} className={styles.featureItem}>âœ“ {f}</li>\r\n                ))}\r\n              </ul>\r\n\r\n              <button\r\n                className={styles.upgradeBtn}\r\n                onClick={() => handleUpgrade(plan.id)}\r\n                disabled={isProcessing || currentPlan === plan.id}\r\n              >\r\n                {currentPlan === plan.id ? \"Current Plan\" : isProcessing ? \"Processing...\" : \"Upgrade Now\"}\r\n              </button>\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        <section className={styles.faqSection}>\r\n          <h2>Frequently Asked Questions</h2>\r\n\r\n          <div className={styles.faqItem}>\r\n            <h4>Can I cancel anytime?</h4>\r\n            <p>You retain access until the end of the billing period.</p>\r\n          </div>\r\n\r\n          <div className={styles.faqItem}>\r\n            <h4>What payment methods do you accept?</h4>\r\n            <p>UPI, cards, wallets through Razorpay.</p>\r\n          </div>\r\n\r\n          <div className={styles.faqItem}>\r\n            <h4>Can I switch plans?</h4>\r\n            <p>Yes, anytime.</p>\r\n          </div>\r\n        </section>\r\n      </main>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}