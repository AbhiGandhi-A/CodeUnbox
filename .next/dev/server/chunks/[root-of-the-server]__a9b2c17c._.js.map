{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/abhig/Downloads/zip-explorer1/lib/mongodb.ts"],"sourcesContent":["import { MongoClient, type Db } from \"mongodb\"\r\n\r\nlet cachedClient: MongoClient | null = null\r\nlet cachedDb: Db | null = null\r\n\r\nexport async function connectToDatabase() {\r\n  const mongoUri = process.env.MONGODB_URI\r\n\r\n  if (!mongoUri || mongoUri.includes(\"your_mongodb_connection_string\")) {\r\n    console.warn(\"[MongoDB] MongoDB URI not configured. Using mock mode for development.\")\r\n    // Return a mock object for development when no valid URI is provided\r\n    return {\r\n      client: null,\r\n      db: {\r\n        collection: () => ({\r\n          findOne: async () => null,\r\n          insertOne: async () => ({ insertedId: \"mock-id\" }),\r\n          updateOne: async () => ({}),\r\n          deleteOne: async () => ({}),\r\n          find: () => ({ toArray: async () => [] }),\r\n        }),\r\n      } as any,\r\n    }\r\n  }\r\n\r\n  if (cachedClient && cachedDb) {\r\n    return { client: cachedClient, db: cachedDb }\r\n  }\r\n\r\n  try {\r\n    const client = new MongoClient(mongoUri)\r\n    await client.connect()\r\n    const db = client.db(\"code-explorer\")\r\n\r\n    cachedClient = client\r\n    cachedDb = db\r\n\r\n    return { client, db }\r\n  } catch (error) {\r\n    console.error(\"Failed to connect to MongoDB:\", error)\r\n    throw error\r\n  }\r\n}\r\n\r\nexport async function closeDatabase() {\r\n  if (cachedClient) {\r\n    await cachedClient.close()\r\n    cachedClient = null\r\n    cachedDb = null\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,IAAI,eAAmC;AACvC,IAAI,WAAsB;AAEnB,eAAe;IACpB,MAAM,WAAW,QAAQ,GAAG,CAAC,WAAW;IAExC,IAAI,CAAC,YAAY,SAAS,QAAQ,CAAC,mCAAmC;QACpE,QAAQ,IAAI,CAAC;QACb,qEAAqE;QACrE,OAAO;YACL,QAAQ;YACR,IAAI;gBACF,YAAY,IAAM,CAAC;wBACjB,SAAS,UAAY;wBACrB,WAAW,UAAY,CAAC;gCAAE,YAAY;4BAAU,CAAC;wBACjD,WAAW,UAAY,CAAC,CAAC,CAAC;wBAC1B,WAAW,UAAY,CAAC,CAAC,CAAC;wBAC1B,MAAM,IAAM,CAAC;gCAAE,SAAS,UAAY,EAAE;4BAAC,CAAC;oBAC1C,CAAC;YACH;QACF;IACF;IAEA,IAAI,gBAAgB,UAAU;QAC5B,OAAO;YAAE,QAAQ;YAAc,IAAI;QAAS;IAC9C;IAEA,IAAI;QACF,MAAM,SAAS,IAAI,sHAAW,CAAC;QAC/B,MAAM,OAAO,OAAO;QACpB,MAAM,KAAK,OAAO,EAAE,CAAC;QAErB,eAAe;QACf,WAAW;QAEX,OAAO;YAAE;YAAQ;QAAG;IACtB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,MAAM;IACR;AACF;AAEO,eAAe;IACpB,IAAI,cAAc;QAChB,MAAM,aAAa,KAAK;QACxB,eAAe;QACf,WAAW;IACb;AACF"}},
    {"offset": {"line": 176, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/abhig/Downloads/zip-explorer1/lib/auth-config.ts"],"sourcesContent":["import { AuthOptions, User } from \"next-auth\"\r\nimport CredentialsProvider from \"next-auth/providers/credentials\"\r\nimport { connectToDatabase } from \"@/lib/mongodb\"¬†\r\nimport bcrypt from \"bcryptjs\"\r\nimport { ObjectId } from \"mongodb\"¬†\r\n\r\n// Note: Relying on the global 'User' type extended in next-auth.d.ts\r\n\r\n// Define the NextAuth options object\r\nexport const authOptions: AuthOptions = {\r\n¬† // Use session strategy based on JWT (standard for stateless serverless functions)\r\n¬† session: {\r\n¬† ¬† strategy: \"jwt\",\r\n¬† },\r\n¬†¬†\r\n¬† providers: [\r\n¬† ¬† CredentialsProvider({\r\n¬† ¬† ¬† name: \"Credentials\",\r\n¬† ¬† ¬† credentials: {\r\n¬† ¬† ¬† ¬† email: { label: \"Email\", type: \"email\" },\r\n¬† ¬† ¬† ¬† password: { label: \"Password\", type: \"password\" },\r\n¬† ¬† ¬† },\r\n¬† ¬† ¬† // Explicitly define the return type as User | null (using the globally extended type)\r\n¬† ¬† ¬† async authorize(credentials): Promise<User | null> {\r\n¬† ¬† ¬† ¬† if (!credentials) {\r\n¬† ¬† ¬† ¬† ¬† return null\r\n¬† ¬† ¬† ¬† }\r\n¬† ¬† ¬† ¬† const { email, password } = credentials\r\n\r\n¬† ¬† ¬† ¬† try {\r\n¬† ¬† ¬† ¬† ¬† const { db } = await connectToDatabase()\r\n¬† ¬† ¬† ¬† ¬† const user = await db.collection(\"users\").findOne({ email })\r\n\r\n¬† ¬† ¬† ¬† ¬† if (!user) {\r\n¬† ¬† ¬† ¬† ¬† ¬† console.error(\"Login failed: User not found for email:\", email)\r\n¬† ¬† ¬† ¬† ¬† ¬† throw new Error(\"Invalid credentials\")¬†\r\n¬† ¬† ¬† ¬† ¬† }\r\n\r\n¬† ¬† ¬† ¬† ¬† const isValid = await bcrypt.compare(password, user.password)\r\n¬† ¬† ¬† ¬† ¬†¬†\r\n¬† ¬† ¬† ¬† ¬† if (!isValid) {\r\n¬† ¬† ¬† ¬† ¬† ¬† console.error(\"Login failed: Invalid password for email:\", email)\r\n¬† ¬† ¬† ¬† ¬† ¬† throw new Error(\"Invalid credentials\")\r\n¬† ¬† ¬† ¬† ¬† }\r\n¬† ¬† ¬† ¬† ¬†¬†\r\n¬† ¬† ¬† ¬† ¬† // Return an object that matches the ExtendedUser interface structure.\r\n¬† ¬† ¬† ¬† ¬† return {\r\n¬† ¬† ¬† ¬† ¬† ¬† id: user._id.toString(), // Must be a string\r\n¬† ¬† ¬† ¬† ¬† ¬† name: user.name as string, // Cast to string if needed\r\n¬† ¬† ¬† ¬† ¬† ¬† email: user.email as string, // Cast to string if needed\r\n¬† ¬† ¬† ¬† ¬† ¬† // üí° FIX 4: Use 'subscriptionPlan' instead of 'tier'\r\n¬† ¬† ¬† ¬† ¬† ¬† subscriptionPlan: user.subscriptionPlan || \"free\",¬†\r\n¬† ¬† ¬† ¬† ¬† } as User\r\n¬† ¬† ¬† ¬† } catch (e) {\r\n¬† ¬† ¬† ¬† ¬† console.error(\"Error during authorization:\", e)\r\n¬† ¬† ¬† ¬† ¬† throw new Error(\"Invalid credentials\")¬†\r\n¬† ¬† ¬† ¬† }\r\n¬† ¬† ¬† },\r\n¬† ¬† }),\r\n¬† ],\r\n¬†¬†\r\n¬† // Custom pages configuration to handle redirects\r\n¬† pages: {\r\n¬† ¬† signIn: \"/login\",\r\n¬† ¬† error: \"/login\",¬†\r\n¬† },\r\n\r\n¬† callbacks: {\r\n¬† ¬† // Add custom properties (id, subscriptionPlan) to the JWT\r\n¬† ¬† async jwt({ token, user, trigger, session }) {\r\n¬† ¬† ¬† if (user) {\r\n¬† ¬† ¬† ¬† token.id = user.id\r\n¬† ¬† ¬† ¬† // üí° FIX 5: Use 'subscriptionPlan' instead of 'tier'\r\n¬† ¬† ¬† ¬† token.subscriptionPlan = (user as User).subscriptionPlan\r\n¬† ¬† ¬† }\r\n\r\n      // üí° FIX 6: Handle session refresh triggered by update() call from client\r\n      if (trigger === \"update\" && session && (session as { subscriptionPlan?: string }).subscriptionPlan) {\r\n        // Update the token's subscriptionPlan with the new value from the update() payload\r\n        token.subscriptionPlan = (session as { subscriptionPlan: string }).subscriptionPlan\r\n      }\r\n¬† ¬† ¬† return token\r\n¬† ¬† },\r\n¬† ¬† // Add custom properties (id, subscriptionPlan) to the session object exposed on the client\r\n¬† ¬† async session({ session, token }) {\r\n¬† ¬† ¬† if (session.user) {\r\n¬† ¬† ¬† ¬† // @ts-ignore: Add custom properties to session.user\r\n¬† ¬† ¬† ¬† session.user.id = token.id\r\n¬† ¬† ¬† ¬† // üí° FIX 7: Use 'subscriptionPlan' instead of 'tier'\r\n¬† ¬† ¬† ¬† // @ts-ignore: Access token.subscriptionPlan\r\n¬† ¬† ¬† ¬† session.user.subscriptionPlan = token.subscriptionPlan\r\n¬† ¬† ¬† }\r\n¬† ¬† ¬† return session\r\n¬† ¬† },\r\n¬† },\r\n}"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;AAMO,MAAM,cAA2B;IACtC,kFAAkF;IAClF,SAAS;QACP,UAAU;IACZ;IAEA,WAAW;QACT,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,sFAAsF;YACtF,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa;oBAChB,OAAO;gBACT;gBACA,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG;gBAE5B,IAAI;oBACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAA,qIAAiB;oBACtC,MAAM,OAAO,MAAM,GAAG,UAAU,CAAC,SAAS,OAAO,CAAC;wBAAE;oBAAM;oBAE1D,IAAI,CAAC,MAAM;wBACT,QAAQ,KAAK,CAAC,2CAA2C;wBACzD,MAAM,IAAI,MAAM;oBAClB;oBAEA,MAAM,UAAU,MAAM,8IAAM,CAAC,OAAO,CAAC,UAAU,KAAK,QAAQ;oBAE5D,IAAI,CAAC,SAAS;wBACZ,QAAQ,KAAK,CAAC,6CAA6C;wBAC3D,MAAM,IAAI,MAAM;oBAClB;oBAEA,sEAAsE;oBACtE,OAAO;wBACL,IAAI,KAAK,GAAG,CAAC,QAAQ;wBACrB,MAAM,KAAK,IAAI;wBACf,OAAO,KAAK,KAAK;wBACjB,qDAAqD;wBACrD,kBAAkB,KAAK,gBAAgB,IAAI;oBAC7C;gBACF,EAAE,OAAO,GAAG;oBACV,QAAQ,KAAK,CAAC,+BAA+B;oBAC7C,MAAM,IAAI,MAAM;gBAClB;YACF;QACF;KACD;IAED,iDAAiD;IACjD,OAAO;QACL,QAAQ;QACR,OAAO;IACT;IAEA,WAAW;QACT,0DAA0D;QAC1D,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE;YACzC,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,qDAAqD;gBACrD,MAAM,gBAAgB,GAAG,AAAC,KAAc,gBAAgB;YAC1D;YAEA,0EAA0E;YAC1E,IAAI,YAAY,YAAY,WAAW,AAAC,QAA0C,gBAAgB,EAAE;gBAClG,mFAAmF;gBACnF,MAAM,gBAAgB,GAAG,AAAC,QAAyC,gBAAgB;YACrF;YACA,OAAO;QACT;QACA,2FAA2F;QAC3F,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,EAAE;gBAChB,oDAAoD;gBACpD,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBAC1B,qDAAqD;gBACrD,4CAA4C;gBAC5C,QAAQ,IAAI,CAAC,gBAAgB,GAAG,MAAM,gBAAgB;YACxD;YACA,OAAO;QACT;IACF;AACF"}},
    {"offset": {"line": 372, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/abhig/Downloads/zip-explorer1/app/api/save-zip/route.ts"],"sourcesContent":["import { connectToDatabase } from \"@/lib/mongodb\"\r\nimport { type NextRequest, NextResponse } from \"next/server\"\r\nimport { getServerSession } from \"next-auth/next\"\r\nimport { authOptions } from \"@/lib/auth-config\"\r\nimport { put } from \"@vercel/blob\"\r\nimport JSZip from \"jszip\"\r\nimport { ObjectId } from \"mongodb\"\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const session = await getServerSession(authOptions)\r\n    if (!session?.user?.id) {\r\n      return NextResponse.json(\r\n        { error: \"Authentication required\" },\r\n        { status: 401 }\r\n      )\r\n    }\r\n\r\n    // ‚≠ê REQUIRED FIX: Blob token for local development & production\r\n    const BLOB_TOKEN = process.env.BLOB_READ_WRITE_TOKEN\r\n    if (!BLOB_TOKEN) {\r\n      console.error(\"‚ùå Missing BLOB_READ_WRITE_TOKEN\")\r\n      return NextResponse.json(\r\n        { error: \"Blob token missing. Configure BLOB_READ_WRITE_TOKEN.\" },\r\n        { status: 500 }\r\n      )\r\n    }\r\n\r\n    const { db } = await connectToDatabase()\r\n    const user = await db.collection(\"users\").findOne({\r\n      _id: new ObjectId(session.user.id),\r\n    })\r\n\r\n    if (!user) {\r\n      return NextResponse.json({ error: \"User not found\" }, { status: 404 })\r\n    }\r\n\r\n    const maxSavedZips =\r\n      user.subscriptionPlan === \"monthly\"\r\n        ? 5\r\n        : user.subscriptionPlan === \"yearly\"\r\n        ? 15\r\n        : 0\r\n\r\n    const savedZipsCount = await db.collection(\"saved_zips\").countDocuments({\r\n      userId: session.user.id,\r\n    })\r\n\r\n    if (savedZipsCount >= maxSavedZips) {\r\n      return NextResponse.json(\r\n        {\r\n          error: `Save limit reached. Your plan allows ${maxSavedZips} saved ZIPs.`,\r\n        },\r\n        { status: 403 }\r\n      )\r\n    }\r\n\r\n    const { zipName, files } = await request.json()\r\n\r\n    // ---- Generate ZIP ----\r\n    const zip = new JSZip()\r\n    for (const file of files) {\r\n      zip.file(file.path, file.content)\r\n    }\r\n\r\n    const zipBlob = await zip.generateAsync({ type: \"blob\" })\r\n    const buffer = Buffer.from(await zipBlob.arrayBuffer())\r\n\r\n    // ---- Upload ZIP to Vercel Blob ----\r\n    const blobResult = await put(\r\n      `saved-zips/${session.user.id}/${zipName}.zip`,\r\n      buffer,\r\n      {\r\n        access: \"public\",\r\n        contentType: \"application/zip\",\r\n        token: BLOB_TOKEN, // ‚≠ê CRITICAL FIX\r\n      }\r\n    )\r\n\r\n    // Save metadata\r\n    await db.collection(\"saved_zips\").insertOne({\r\n      userId: session.user.id,\r\n      name: zipName,\r\n      blobUrl: blobResult.url,\r\n      fileCount: files.length,\r\n      createdAt: new Date(),\r\n      updatedAt: new Date(),\r\n    })\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: \"ZIP saved successfully\",\r\n      url: blobResult.url,\r\n    })\r\n  } catch (error) {\r\n    console.error(\"Save ZIP error:\", error)\r\n    return NextResponse.json(\r\n      { error: \"Failed to save ZIP\" },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,mKAAgB,EAAC,sIAAW;QAClD,IAAI,CAAC,SAAS,MAAM,IAAI;YACtB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,gEAAgE;QAChE,MAAM,aAAa,QAAQ,GAAG,CAAC,qBAAqB;QACpD,IAAI,CAAC,YAAY;YACf,QAAQ,KAAK,CAAC;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAuD,GAChE;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,IAAA,qIAAiB;QACtC,MAAM,OAAO,MAAM,GAAG,UAAU,CAAC,SAAS,OAAO,CAAC;YAChD,KAAK,IAAI,mHAAQ,CAAC,QAAQ,IAAI,CAAC,EAAE;QACnC;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QAEA,MAAM,eACJ,KAAK,gBAAgB,KAAK,YACtB,IACA,KAAK,gBAAgB,KAAK,WAC1B,KACA;QAEN,MAAM,iBAAiB,MAAM,GAAG,UAAU,CAAC,cAAc,cAAc,CAAC;YACtE,QAAQ,QAAQ,IAAI,CAAC,EAAE;QACzB;QAEA,IAAI,kBAAkB,cAAc;YAClC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,OAAO,CAAC,qCAAqC,EAAE,aAAa,YAAY,CAAC;YAC3E,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE7C,yBAAyB;QACzB,MAAM,MAAM,IAAI,kJAAK;QACrB,KAAK,MAAM,QAAQ,MAAO;YACxB,IAAI,IAAI,CAAC,KAAK,IAAI,EAAE,KAAK,OAAO;QAClC;QAEA,MAAM,UAAU,MAAM,IAAI,aAAa,CAAC;YAAE,MAAM;QAAO;QACvD,MAAM,SAAS,OAAO,IAAI,CAAC,MAAM,QAAQ,WAAW;QAEpD,sCAAsC;QACtC,MAAM,aAAa,MAAM,IAAA,0KAAG,EAC1B,CAAC,WAAW,EAAE,QAAQ,IAAI,CAAC,EAAE,CAAC,CAAC,EAAE,QAAQ,IAAI,CAAC,EAC9C,QACA;YACE,QAAQ;YACR,aAAa;YACb,OAAO;QACT;QAGF,gBAAgB;QAChB,MAAM,GAAG,UAAU,CAAC,cAAc,SAAS,CAAC;YAC1C,QAAQ,QAAQ,IAAI,CAAC,EAAE;YACvB,MAAM;YACN,SAAS,WAAW,GAAG;YACvB,WAAW,MAAM,MAAM;YACvB,WAAW,IAAI;YACf,WAAW,IAAI;QACjB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;YACT,KAAK,WAAW,GAAG;QACrB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAqB,GAC9B;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}